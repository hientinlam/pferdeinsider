<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2012 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>
<div class="block block-account">
    <div class="block-title">
        <strong><span><?php echo $this->__('Mein Account'); ?></span></strong>
    </div>
    <?php 
         $groupid=Mage::getSingleton('customer/session')->getCustomer()->getGroupId();
         $customer=Mage::getModel('customer/session')->getCustomer();
         $customerId=$customer->getId();
         $affiliate =  Mage::getModel('awaffiliate/affiliate')->getCollection()->getData();
         foreach($affiliate as $inactive):
             if($customerId==$inactive['customer_id']):
                $status=$inactive['status'];
                 break;
             endif;
         endforeach;?>
    <div class="block-content">
        <ul>
            <?php $_links = $this->getLinks();
            //echo "<pre>";print_r($_links);die('helo');?>
            <?php $_index = 1; ?>
            <?php $_count = count($_links); ?>
            <?php
			/**
			 *  custom added code
			 */

			// PhuongLan custom code to re-sort navigation list
			$newsort = array();
			foreach ($_links as $k => $resort): // assigning number to sort
				if ($k == "orders"):
					$i = 0;
				elseif ($k == "customer"):
					$i = 1;
				elseif ($k == "member_videos"):
					$i = 2;
				elseif ($k == "review"):
					$i = 3;
				elseif ($k == "tags"):
					$i = 4;
				elseif ($k == "wishlist"):
					$i = 5
				elseif ($k == "expertcalculation"):
					$i = 6;
				elseif ($k == "allmembers"):
					$i = 7;
				elseif ($k == "allmember"):
					$i = 8;
				elseif ($k == "createproduct"):
					$i = 9;
				elseif ($k == "create_product"):
					$i = 10;
				elseif ($k == "account_editPersonalinfo"):
					$i = 11;
				elseif ($k == "myprofile"):
					$i = 12;
				elseif ($k == "account_edit"):
					$i = 13;
				elseif ($k == "address_book"):
					$i = 14;
				elseif ($k == "Bank Information"):
					$i = 15;
				elseif ($k == "member_videos"):
					$i = 16;
				elseif ($k == "facebookconnect"):
					$i = 17;
				elseif ($k == "mailchimp"):
					$i = 18;
				elseif ($k = "customer.profile.messages"):
					$i = 19;
				elseif ($k == "promote_products"):
					$i = 20;
				endif;
				$newsort[$i] = $resort;
			endforeach;
			
			ksort($newsort); //re-sort navigation list
			
			echo "<pre>";
			print_r($newsort);
			echo "</pre>";
			exit;
			$newsort = (object) $newsort;
			$_links = $newsort;
			// PhuongLan end custom code
			
            if($groupid==4)
            {
				foreach ($_links as $_link):
					if($_link->getLabel()!='Promote Products' && $_link->getLabel()!='Member Videos') {
                        $_last = ($_index++ >= $_count);
                        if ($this->isActive($_link)):
			?>
                            <li class="current<?php echo ($_last ? ' last' : '') ?>"><strong><?php echo $_link->getLabel() ?></strong></li>
                        <?php else: ?>
                            <?php if($_link->getLabel()=='Affiliate Program' && $status=='active'): ?>
                                <li<?php echo ($_last ? ' class="last"' : '') ?>><a href="<?php echo $_link->getUrl() ?>"><?php echo $_link->getLabel() ?></a></li>
                            <?php elseif($_link->getLabel()!='Affiliate Program'): ?>
                                <li<?php echo ($_last ? ' class="last"' : '') ?>><a href="<?php echo $_link->getUrl() ?>"><?php echo $_link->getLabel() ?></a></li>
                            <?php endif; ?>
                        <?php endif;  }?>                            
                    <?php endforeach; ?>
      <?php   }
              else 
              { ?>
                     <?php foreach ($_links as $_link): ?>
                     <?php if($_link->getLabel()!='Create Product' && $_link->getLabel()!='Bank Information'&& $_link->getLabel()!='Meine Produkte' && $_link->getLabel()!='Promote Products'){?>
                            <?php $_last = ($_index++ >= $_count); ?>
                            <?php if ($this->isActive($_link)): ?>
                                <li class="current<?php echo ($_last ? ' last' : '') ?>"><strong><?php echo $_link->getLabel() ?></strong></li>
                            <?php else: ?>
                                <?php if($_link->getLabel()=='Affiliate Program' && $status=='active'): ?>
                                <li<?php echo ($_last ? ' class="last"' : '') ?>><a href="<?php echo $_link->getUrl() ?>"><?php echo $_link->getLabel() ?></a></li>
                            <?php elseif($_link->getLabel()!='Affiliate Program' && $_link->getLabel()!='Einnahmen über Webseite' && $_link->getLabel()!='Meine Einnahmen' && $_link->getLabel()!='Einnahmen über Affiliate Partner'  ): ?>
                                  <li<?php echo ($_last ? ' class="last"' : '') ?>><a href="<?php echo $_link->getUrl() ?>"><?php echo $_link->getLabel() ?></a></li>
                            <?php endif; ?>
                            <?php endif; ?>
                                <?php }?>
                    <?php endforeach; ?>
        <?php }?>
        </ul>
    </div>
</div>